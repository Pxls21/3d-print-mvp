# ============================================================================
# 3D PRINT MVP - SECURE ENVIRONMENT CONFIGURATION
# ============================================================================
#
# ⚠️  SECURITY NOTICE:
# 1. NEVER commit the actual .env file to git (already in .gitignore)
# 2. Generate strong random secrets for production (use: openssl rand -hex 32)
# 3. Rotate secrets every 90 days
# 4. Use environment-specific .env files (.env.development, .env.production)
# 5. Consider using secrets management (HashiCorp Vault, AWS Secrets Manager)
#
# Copy this file to .env and fill in your values
# ============================================================================

# ============================================================================
# ENVIRONMENT
# ============================================================================
NODE_ENV=development
ENVIRONMENT=development

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# PostgreSQL credentials (change in production!)
POSTGRES_USER=postgres
POSTGRES_PASSWORD=ChangeMeInProduction123!

# Full database URL (used by applications)
DATABASE_URL=postgresql://postgres:ChangeMeInProduction123!@localhost:5432/rd_platform
SQL_ECHO=false

# ⚠️  SECURITY: Generate strong password with: openssl rand -base64 32
# Production example: POSTGRES_PASSWORD=7xK9mP3nQ2vL8wR5tY1hF6jD4sA0zX

# ============================================================================
# REDIS CONFIGURATION (Cache & Job Queue)
# ============================================================================
# Redis password (REQUIRED for security)
REDIS_PASSWORD=ChangeMeRedis123!

# Full Redis URL with authentication
REDIS_URL=redis://:ChangeMeRedis123!@localhost:6379

# ⚠️  SECURITY: Generate strong password with: openssl rand -hex 24

# ============================================================================
# CLOUDFLARE R2 (S3-compatible storage)
# ============================================================================
R2_ACCOUNT_ID=your_account_id_here
R2_ACCESS_KEY_ID=your_access_key_here
R2_SECRET_ACCESS_KEY=your_secret_key_here
R2_BUCKET_NAME=rd-platform
R2_PUBLIC_URL=https://pub-xxxxx.r2.dev  # Optional: custom domain

# ============================================================================
# GPU PROCESSING SERVER
# ============================================================================
# Local RTX 3090 server or RunPod endpoint
GPU_SERVER_URL=http://localhost:8001
GPU_SERVER_API_KEY=your_gpu_server_key

# RunPod (for production)
RUNPOD_API_KEY=your_runpod_api_key_here
RUNPOD_ENDPOINT_ID=your_endpoint_id_here

# ============================================================================
# JWT & AUTHENTICATION SECRETS
# ============================================================================
# JWT secret for token signing (CRITICAL - rotate every 90 days)
JWT_SECRET=

# Cookie secret for session management
COOKIE_SECRET=

# ⚠️  SECURITY: Generate with: openssl rand -hex 32
# Example: JWT_SECRET=f8a3b2c1d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1
# DO NOT use the example above - generate your own!

# ============================================================================
# CORS & ALLOWED ORIGINS
# ============================================================================
# Comma-separated list of allowed origins (NO WILDCARDS in production)
ALLOWED_ORIGINS=http://localhost:3000

# Store CORS (for Medusa.js)
STORE_CORS=http://localhost:3000,http://localhost:8000

# Admin CORS (for Medusa admin panel)
ADMIN_CORS=http://localhost:7001

# Allowed hostnames (prevent host header injection)
ALLOWED_HOSTS=localhost,127.0.0.1

# Production example:
# ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
# ADMIN_CORS=https://admin.yourdomain.com
# ALLOWED_HOSTS=yourdomain.com,admin.yourdomain.com,api.yourdomain.com

# ============================================================================
# PAYMENT PROCESSING (STRIPE)
# ============================================================================
# Stripe secret key (server-side)
STRIPE_SECRET_KEY=sk_test_xxxxx

# Stripe publishable key (client-side - safe to expose)
STRIPE_PUBLISHABLE_KEY=pk_test_xxxxx
NEXT_PUBLIC_STRIPE_KEY=pk_test_xxxxx

# Stripe webhook secret (for webhook signature verification)
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# ⚠️  SECURITY: Use test keys in development, live keys in production

# ============================================================================
# FRONTEND
# ============================================================================
NEXT_PUBLIC_MEDUSA_BACKEND_URL=http://localhost:9000
NEXT_PUBLIC_API_URL=http://localhost:8000

# ============================================================================
# BAMBU LAB 3D PRINTERS (LAN Mode)
# ============================================================================
# Bambu Lab P1S Printer 1
BAMBU_1_IP=192.168.1.100
BAMBU_1_ACCESS_CODE=your_8_digit_access_code
BAMBU_1_SERIAL=your_printer_serial_number
BAMBU_1_NAME=Bambu Lab P1S #1

# Bambu Lab P1S Printer 2
BAMBU_2_IP=192.168.1.101
BAMBU_2_ACCESS_CODE=your_8_digit_access_code
BAMBU_2_SERIAL=your_printer_serial_number
BAMBU_2_NAME=Bambu Lab P1S #2

# Note: Enable LAN Mode in printer settings
# Get access code from: Settings → Network → LAN Mode
# Uses bambulabs-api Python package (MIT licensed)

# ⚠️  SECURITY:
# 1. Place printers on isolated VLAN (recommended: 192.168.100.0/24)
# 2. Rotate access codes monthly via printer settings
# 3. Use firewall rules to restrict printer access to API server only
# 4. Never expose printer IPs to the internet
# 5. Consider encrypting access codes in .env (see SECURITY.md)

# ============================================================================
# MONITORING & ERROR TRACKING
# ============================================================================
SENTRY_DSN=https://xxxxx@sentry.io/xxxxx
ENVIRONMENT=development  # development, staging, production

# ============================================================================
# RATE LIMITING CONFIGURATION
# ============================================================================
# Enable rate limiting (true/false)
RATE_LIMIT_ENABLED=true

# Global rate limit (requests per window)
RATE_LIMIT_REQUESTS=100

# Rate limit window (seconds)
RATE_LIMIT_WINDOW=60

# Production recommendations:
# - API endpoints: 100 req/min
# - Job creation: 10 req/min
# - File upload: 5 req/min
# - Admin endpoints: 30 req/min

# ============================================================================
# FILE UPLOAD LIMITS
# ============================================================================
# Maximum file size (bytes) - 10MB default
MAX_FILE_SIZE=10485760

# Maximum files per request (for multi-file uploads)
MAX_FILES_PER_REQUEST=50

# Production recommendations:
# - Individual image: 10MB
# - Total batch: 500MB
# - Scan images: 20-50 files

# ============================================================================
# SECURITY HEADERS
# ============================================================================
# Enable HSTS (HTTP Strict Transport Security)
ENABLE_HSTS=false

# HSTS max age (seconds) - 1 year default
HSTS_MAX_AGE=31536000

# ⚠️  Production: Enable HSTS only after TLS/SSL is configured
# ENABLE_HSTS=true

# Encryption key for sensitive data
ENCRYPTION_KEY=your_32_character_encryption_key

# ============================================================================
# EMAIL CONFIGURATION (for notifications)
# ============================================================================
# SMTP server settings
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_specific_password
FROM_EMAIL=noreply@yourplatform.com

# ⚠️  SECURITY: Use app-specific passwords, not account passwords
# Gmail: https://myaccount.google.com/apppasswords

# ============================================================================
# DEVELOPMENT TOOLS (Optional)
# ============================================================================
# PgAdmin (Database management UI)
PGADMIN_EMAIL=admin@localhost.local
PGADMIN_PASSWORD=ChangeMePgAdmin123!

# MinIO (Local S3-compatible storage)
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=ChangeMeMinio123!

# Flower (Celery monitoring)
FLOWER_USER=admin
FLOWER_PASSWORD=ChangeMeFlower123!

# ⚠️  SECURITY: Change default credentials immediately

# ============================================================================
# DEVELOPMENT SETTINGS
# ============================================================================
DEBUG=true
LOG_LEVEL=INFO

# ============================================================================
# TLS/SSL CONFIGURATION (Production Only)
# ============================================================================
# Enable SSL (true/false)
ENABLE_SSL=false

# SSL certificate paths
SSL_CERT_PATH=/etc/ssl/certs/cert.pem
SSL_KEY_PATH=/etc/ssl/private/key.pem

# Production: Use Let's Encrypt or commercial SSL certificate
# ENABLE_SSL=true
# SSL_CERT_PATH=/etc/letsencrypt/live/yourdomain.com/fullchain.pem
# SSL_KEY_PATH=/etc/letsencrypt/live/yourdomain.com/privkey.pem

# ============================================================================
# SECURITY BEST PRACTICES CHECKLIST
# ============================================================================
#
# Before deploying to production:
#
# [ ] Generate strong random secrets for ALL secret keys
# [ ] Change ALL default passwords (database, redis, pgadmin, etc.)
# [ ] Rotate Bambu Lab printer access codes
# [ ] Configure ALLOWED_ORIGINS with your domain (remove localhost)
# [ ] Set up TLS/SSL certificates (Let's Encrypt recommended)
# [ ] Enable HSTS after SSL is configured
# [ ] Configure Sentry for error monitoring
# [ ] Set up database backups (daily recommended)
# [ ] Configure firewall rules for printer network isolation
# [ ] Review and test rate limiting settings
# [ ] Enable audit logging and monitor logs regularly
# [ ] Set up secrets rotation schedule (90 days)
# [ ] Test disaster recovery procedures
# [ ] Review docker-compose.yml port bindings (127.0.0.1 for localhost only)
#
# See SECURITY.md for detailed security documentation
#
# ============================================================================
